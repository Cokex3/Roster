define(["../core","./var/nonce","./var/rquery","../ajax"],function(e,t,n){"use strict";var i=[],r=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=i.pop()||e.expando+"_"+t++;return this[n]=!0,n}}),e.ajaxPrefilter("json jsonp",function(t,s,a){var o,l,u,c=t.jsonp!==!1&&(r.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&r.test(t.data)&&"data");return c||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=e.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,c?t[c]=t[c].replace(r,"$1"+o):t.jsonp!==!1&&(t.url+=(n.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return u||e.error(o+" was not called"),u[0]},t.dataTypes[0]="json",l=window[o],window[o]=function(){u=arguments},a.always(function(){void 0===l?e(window).removeProp(o):window[o]=l,t[o]&&(t.jsonpCallback=s.jsonpCallback,i.push(o)),u&&e.isFunction(l)&&l(u[0]),u=l=void 0}),"script"):void 0})});