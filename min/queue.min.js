define(["./core","./data/var/dataPriv","./deferred","./callbacks"],function(e,t){"use strict";return e.extend({queue:function(n,i,r){var s;return n?(i=(i||"fx")+"queue",s=t.get(n,i),r&&(!s||Array.isArray(r)?s=t.access(n,i,e.makeArray(r)):s.push(r)),s||[]):void 0},dequeue:function(t,n){n=n||"fx";var i=e.queue(t,n),r=i.length,s=i.shift(),o=e._queueHooks(t,n),a=function(){e.dequeue(t,n)};"inprogress"===s&&(s=i.shift(),r--),s&&("fx"===n&&i.unshift("inprogress"),delete o.stop,s.call(t,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(n,i){var r=i+"queueHooks";return t.get(n,r)||t.access(n,r,{empty:e.Callbacks("once memory").add(function(){t.remove(n,[i+"queue",r])})})}}),e.fn.extend({queue:function(t,n){var i=2;return"string"!=typeof t&&(n=t,t="fx",i--),arguments.length<i?e.queue(this[0],t):void 0===n?this:this.each(function(){var i=e.queue(this,t,n);e._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&e.dequeue(this,t)})},dequeue:function(t){return this.each(function(){e.dequeue(this,t)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(n,i){var r,s=1,o=e.Deferred(),a=this,l=this.length,u=function(){--s||o.resolveWith(a,[a])};for("string"!=typeof n&&(i=n,n=void 0),n=n||"fx";l--;)r=t.get(a[l],n+"queueHooks"),r&&r.empty&&(s++,r.empty.add(u));return u(),o.promise(i)}}),e});